<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Modelo Predictivo - Supervivencia en el Titanic</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            background: linear-gradient(135deg, #1a2a6c, #2a5298);
            color: white;
            padding: 30px 0;
            text-align: center;
            border-radius: 10px;
            margin-bottom: 30px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        
        header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        header p {
            font-size: 1.2rem;
            opacity: 0.9;
            max-width: 800px;
            margin: 0 auto;
        }
        
        .titanic-icon {
            font-size: 2.5rem;
            margin-bottom: 15px;
            color: #ffcc00;
        }
        
        .main-content {
            display: flex;
            flex-wrap: wrap;
            gap: 30px;
            margin-bottom: 40px;
        }
        
        .panel {
            background: white;
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            flex: 1;
            min-width: 300px;
        }
        
        .panel h2 {
            color: #2a5298;
            border-bottom: 2px solid #f0f0f0;
            padding-bottom: 10px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .panel h2 i {
            color: #1a2a6c;
        }
        
        .data-section {
            flex: 2;
        }
        
        .prediction-section {
            flex: 1;
        }
        
        .data-info {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }
        
        .data-card {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            border-left: 4px solid #2a5298;
        }
        
        .data-card h3 {
            font-size: 1rem;
            color: #555;
            margin-bottom: 8px;
        }
        
        .data-card .value {
            font-size: 1.8rem;
            font-weight: bold;
            color: #1a2a6c;
        }
        
        .data-card .survived {
            color: #28a745;
        }
        
        .data-card .not-survived {
            color: #dc3545;
        }
        
        .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 25px;
        }
        
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn-primary {
            background-color: #2a5298;
            color: white;
        }
        
        .btn-primary:hover {
            background-color: #1a2a6c;
            transform: translateY(-2px);
        }
        
        .btn-secondary {
            background-color: #6c757d;
            color: white;
        }
        
        .btn-secondary:hover {
            background-color: #5a6268;
            transform: translateY(-2px);
        }
        
        .btn-success {
            background-color: #28a745;
            color: white;
        }
        
        .btn-success:hover {
            background-color: #218838;
            transform: translateY(-2px);
        }
        
        .input-group {
            margin-bottom: 20px;
        }
        
        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #555;
        }
        
        .input-group input, 
        .input-group select {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 1rem;
        }
        
        .input-group input:focus, 
        .input-group select:focus {
            outline: none;
            border-color: #2a5298;
        }
        
        .prediction-result {
            margin-top: 25px;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            display: none;
        }
        
        .prediction-result.show {
            display: block;
            animation: fadeIn 0.5s ease;
        }
        
        .prediction-result.survived {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .prediction-result.not-survived {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .result-icon {
            font-size: 3rem;
            margin-bottom: 15px;
        }
        
        .result-text {
            font-size: 1.3rem;
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .probability {
            font-size: 1.1rem;
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px dashed rgba(0,0,0,0.1);
        }
        
        .model-info {
            background-color: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
        }
        
        .model-info h3 {
            color: #2a5298;
            margin-bottom: 10px;
        }
        
        .accuracy-meter {
            height: 10px;
            background-color: #e9ecef;
            border-radius: 5px;
            margin: 15px 0;
            overflow: hidden;
        }
        
        .accuracy-fill {
            height: 100%;
            background: linear-gradient(to right, #28a745, #20c997);
            width: 0%;
            transition: width 1.5s ease;
        }
        
        .accuracy-text {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
        }
        
        .features-list {
            list-style-type: none;
            padding-left: 0;
        }
        
        .features-list li {
            padding: 8px 0;
            border-bottom: 1px dotted #ddd;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .features-list li:last-child {
            border-bottom: none;
        }
        
        .features-list i {
            color: #2a5298;
        }
        
        footer {
            text-align: center;
            padding: 20px;
            color: #666;
            font-size: 0.9rem;
            border-top: 1px solid #eee;
            margin-top: 40px;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @media (max-width: 768px) {
            .main-content {
                flex-direction: column;
            }
            
            .data-info {
                grid-template-columns: 1fr;
            }
            
            header h1 {
                font-size: 2rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="titanic-icon">
                <i class="fas fa-ship"></i>
            </div>
            <h1>Modelo Predictivo - Supervivencia en el Titanic</h1>
            <p>Utiliza machine learning para pronosticar si un pasajero habría sobrevivido al desastre del Titanic basándose en sus características personales</p>
        </header>
        
        <div class="main-content">
            <div class="panel data-section">
                <h2><i class="fas fa-database"></i> Datos del Titanic</h2>
                
                <div class="data-info">
                    <div class="data-card">
                        <h3>Total de Pasajeros</h3>
                        <div class="value" id="total-passengers">0</div>
                    </div>
                    <div class="data-card">
                        <h3>Sobrevivientes</h3>
                        <div class="value survived" id="survived-count">0</div>
                    </div>
                    <div class="data-card">
                        <h3>No Sobrevivientes</h3>
                        <div class="value not-survived" id="not-survived-count">0</div>
                    </div>
                    <div class="data-card">
                        <h3>Tasa de Supervivencia</h3>
                        <div class="value" id="survival-rate">0%</div>
                    </div>
                </div>
                
                <div class="controls">
                    <button class="btn btn-primary" id="load-data">
                        <i class="fas fa-file-upload"></i> Cargar Dataset
                    </button>
                    <button class="btn btn-secondary" id="train-model">
                        <i class="fas fa-cogs"></i> Entrenar Modelo
                    </button>
                    <button class="btn btn-secondary" id="test-model">
                        <i class="fas fa-vial"></i> Probar Modelo
                    </button>
                </div>
                
                <div class="model-info">
                    <h3>Información del Modelo Predictivo</h3>
                    <p>Este modelo utiliza un algoritmo de Naive Bayes para predecir la supervivencia basándose en las siguientes características:</p>
                    
                    <ul class="features-list">
                        <li><i class="fas fa-user-tag"></i> Clase (1ª, 2ª, 3ª)</li>
                        <li><i class="fas fa-venus-mars"></i> Género (Hombre/Mujer)</li>
                        <li><i class="fas fa-birthday-cake"></i> Edad</li>
                        <li><i class="fas fa-money-bill-wave"></i> Tarifa pagada</li>
                        <li><i class="fas fa-map-marker-alt"></i> Puerto de embarque</li>
                    </ul>
                    
                    <div class="accuracy-text">
                        <span>Precisión del modelo:</span>
                        <span id="accuracy-value">0%</span>
                    </div>
                    <div class="accuracy-meter">
                        <div class="accuracy-fill" id="accuracy-fill"></div>
                    </div>
                    <p id="model-status">Modelo no entrenado. Por favor, cargue los datos y entrene el modelo.</p>
                </div>
            </div>
            
            <div class="panel prediction-section">
                <h2><i class="fas fa-crystal-ball"></i> Realizar Predicción</h2>
                
                <div class="input-group">
                    <label for="pclass"><i class="fas fa-user-tag"></i> Clase del Pasajero</label>
                    <select id="pclass">
                        <option value="1">Primera Clase</option>
                        <option value="2">Segunda Clase</option>
                        <option value="3" selected>Tercera Clase</option>
                    </select>
                </div>
                
                <div class="input-group">
                    <label for="sex"><i class="fas fa-venus-mars"></i> Género</label>
                    <select id="sex">
                        <option value="male">Hombre</option>
                        <option value="female" selected>Mujer</option>
                    </select>
                </div>
                
                <div class="input-group">
                    <label for="age"><i class="fas fa-birthday-cake"></i> Edad</label>
                    <input type="number" id="age" min="0" max="100" value="25">
                </div>
                
                <div class="input-group">
                    <label for="fare"><i class="fas fa-money-bill-wave"></i> Tarifa Pagada ($)</label>
                    <input type="number" id="fare" min="0" max="600" value="30">
                </div>
                
                <div class="input-group">
                    <label for="embarked"><i class="fas fa-map-marker-alt"></i> Puerto de Embarque</label>
                    <select id="embarked">
                        <option value="C">Cherbourg</option>
                        <option value="Q">Queenstown</option>
                        <option value="S" selected>Southampton</option>
                    </select>
                </div>
                
                <button class="btn btn-success" id="predict-btn">
                    <i class="fas fa-calculator"></i> Predecir Supervivencia
                </button>
                
                <div class="prediction-result" id="prediction-result">
                    <div class="result-icon" id="result-icon"></div>
                    <div class="result-text" id="result-text"></div>
                    <div class="probability" id="probability-text"></div>
                </div>
            </div>
        </div>
        
        <footer>
            <p>Modelo Predictivo de Supervivencia del Titanic • Implementado con JavaScript • Datos basados en el dataset histórico del Titanic</p>
            <p>Nota: Este es un modelo de demostración con fines educativos</p>
        </footer>
    </div>

    <script>
        // Variables globales
        let titanicData = [];
        let model = null;
        let modelAccuracy = 0;
        
        // Elementos DOM
        const loadDataBtn = document.getElementById('load-data');
        const trainModelBtn = document.getElementById('train-model');
        const testModelBtn = document.getElementById('test-model');
        const predictBtn = document.getElementById('predict-btn');
        const predictionResult = document.getElementById('prediction-result');
        const resultIcon = document.getElementById('result-icon');
        const resultText = document.getElementById('result-text');
        const probabilityText = document.getElementById('probability-text');
        const modelStatus = document.getElementById('model-status');
        const accuracyValue = document.getElementById('accuracy-value');
        const accuracyFill = document.getElementById('accuracy-fill');
        
        // Contadores de datos
        const totalPassengersEl = document.getElementById('total-passengers');
        const survivedCountEl = document.getElementById('survived-count');
        const notSurvivedCountEl = document.getElementById('not-survived-count');
        const survivalRateEl = document.getElementById('survival-rate');
        
        // Función para cargar y procesar los datos
        async function loadDataset() {
            try {
                // En una implementación real, aquí cargaríamos el archivo CSV
                // Para esta demostración, usaremos datos simulados basados en el CSV proporcionado
                
                // Parsear los datos del CSV incluido en el archivo
                const csvContent = `PassengerId,Survived,Pclass,Name,Sex,Age,SibSp,Parch,Ticket,Fare,Cabin,Embarked
1,0,3,"Braund, Mr. Owen Harris",male,22,1,0,A/5 21171,7.25,,S
2,1,1,"Cumings, Mrs. John Bradley (Florence Briggs Thayer)",female,38,1,0,PC 17599,71.2833,C85,C
3,1,3,"Heikkinen, Miss. Laina",female,26,0,0,STON/O2. 3101282,7.925,,S
4,1,1,"Futrelle, Mrs. Jacques Heath (Lily May Peel)",female,35,1,0,113803,53.1,C123,S
5,0,3,"Allen, Mr. William Henry",male,35,0,0,373450,8.05,,S
6,0,3,"Moran, Mr. James",male,,0,0,330877,8.4583,,Q
7,0,1,"McCarthy, Mr. Timothy J",male,54,0,0,17463,51.8625,E46,S
8,0,3,"Palsson, Master. Gosta Leonard",male,2,3,1,349909,21.075,,S
9,1,3,"Johnson, Mrs. Oscar W (Elisabeth Vilhelmina Berg)",female,27,0,2,347742,11.1333,,S
10,1,2,"Nasser, Mrs. Nicholas (Adele Achem)",female,14,1,0,237736,30.0708,,C`;
                
                // Convertir CSV a array de objetos
                const lines = csvContent.split('\n');
                const headers = lines[0].split(',');
                
                titanicData = [];
                
                for (let i = 1; i < lines.length; i++) {
                    if (lines[i].trim() === '') continue;
                    
                    const values = parseCSVLine(lines[i]);
                    const passenger = {};
                    
                    for (let j = 0; j < headers.length; j++) {
                        passenger[headers[j]] = values[j];
                    }
                    
                    // Convertir tipos de datos
                    passenger.PassengerId = parseInt(passenger.PassengerId);
                    passenger.Survived = parseInt(passenger.Survived);
                    passenger.Pclass = parseInt(passenger.Pclass);
                    passenger.Age = passenger.Age ? parseFloat(passenger.Age) : null;
                    passenger.SibSp = parseInt(passenger.SibSp);
                    passenger.Parch = parseInt(passenger.Parch);
                    passenger.Fare = passenger.Fare ? parseFloat(passenger.Fare) : null;
                    
                    titanicData.push(passenger);
                }
                
                // Agregar más datos de ejemplo para tener un dataset más completo
                addMoreExampleData();
                
                // Actualizar estadísticas
                updateDataStats();
                
                // Mostrar mensaje de éxito
                showNotification('Datos cargados exitosamente', 'success');
                modelStatus.textContent = `Datos cargados: ${titanicData.length} pasajeros. Ahora puede entrenar el modelo.`;
                
            } catch (error) {
                console.error('Error al cargar los datos:', error);
                showNotification('Error al cargar los datos', 'error');
            }
        }
        
        // Función para parsear una línea CSV (maneja comillas)
        function parseCSVLine(line) {
            const values = [];
            let currentValue = '';
            let insideQuotes = false;
            
            for (let i = 0; i < line.length; i++) {
                const char = line[i];
                
                if (char === '"') {
                    insideQuotes = !insideQuotes;
                } else if (char === ',' && !insideQuotes) {
                    values.push(currentValue);
                    currentValue = '';
                } else {
                    currentValue += char;
                }
            }
            
            values.push(currentValue);
            return values;
        }
        
        // Función para agregar más datos de ejemplo
        function addMoreExampleData() {
            // Agregar más datos de ejemplo para tener un dataset más representativo
            const exampleData = [
                {PassengerId: 11, Survived: 1, Pclass: 3, Name: "Sandstrom, Miss. Marguerite Rut", Sex: "female", Age: 4, SibSp: 1, Parch: 1, Ticket: "PP 9549", Fare: 16.7, Cabin: "G6", Embarked: "S"},
                {PassengerId: 12, Survived: 1, Pclass: 1, Name: "Bonnell, Miss. Elizabeth", Sex: "female", Age: 58, SibSp: 0, Parch: 0, Ticket: "113783", Fare: 26.55, Cabin: "C103", Embarked: "S"},
                {PassengerId: 13, Survived: 0, Pclass: 3, Name: "Saundercock, Mr. William Henry", Sex: "male", Age: 20, SibSp: 0, Parch: 0, Ticket: "A/5. 2151", Fare: 8.05, Cabin: null, Embarked: "S"},
                {PassengerId: 14, Survived: 0, Pclass: 3, Name: "Andersson, Mr. Anders Johan", Sex: "male", Age: 39, SibSp: 1, Parch: 5, Ticket: "347082", Fare: 31.275, Cabin: null, Embarked: "S"},
                {PassengerId: 15, Survived: 0, Pclass: 3, Name: "Vestrom, Miss. Hulda Amanda Adolfina", Sex: "female", Age: 14, SibSp: 0, Parch: 0, Ticket: "350406", Fare: 7.8542, Cabin: null, Embarked: "S"},
                {PassengerId: 16, Survived: 1, Pclass: 2, Name: "Hewlett, Mrs. (Mary D Kingcome)", Sex: "female", Age: 55, SibSp: 0, Parch: 0, Ticket: "248706", Fare: 16, Cabin: null, Embarked: "S"},
                {PassengerId: 17, Survived: 0, Pclass: 3, Name: "Rice, Master. Eugene", Sex: "male", Age: 2, SibSp: 4, Parch: 1, Ticket: "382652", Fare: 29.125, Cabin: null, Embarked: "Q"},
                {PassengerId: 18, Survived: 1, Pclass: 2, Name: "Williams, Mr. Charles Eugene", Sex: "male", Age: null, SibSp: 0, Parch: 0, Ticket: "244373", Fare: 13, Cabin: null, Embarked: "S"},
                {PassengerId: 19, Survived: 0, Pclass: 3, Name: "Vander Planke, Mrs. Julius (Emelia Maria Vandemoortele)", Sex: "female", Age: 31, SibSp: 1, Parch: 0, Ticket: "345763", Fare: 18, Cabin: null, Embarked: "S"},
                {PassengerId: 20, Survived: 1, Pclass: 3, Name: "Masselmani, Mrs. Fatima", Sex: "female", Age: null, SibSp: 0, Parch: 0, Ticket: "2649", Fare: 7.225, Cabin: null, Embarked: "C"}
            ];
            
            titanicData = titanicData.concat(exampleData);
            
            // Agregar aún más datos para simular un dataset completo
            for (let i = 21; i <= 50; i++) {
                const survived = Math.random() > 0.6 ? 1 : 0;
                const pclass = Math.floor(Math.random() * 3) + 1;
                const sex = Math.random() > 0.5 ? "male" : "female";
                const age = Math.floor(Math.random() * 70) + 1;
                const fare = pclass === 1 ? Math.random() * 300 + 50 : 
                            pclass === 2 ? Math.random() * 50 + 10 : 
                            Math.random() * 30 + 5;
                const embarked = ["C", "Q", "S"][Math.floor(Math.random() * 3)];
                
                titanicData.push({
                    PassengerId: i,
                    Survived: survived,
                    Pclass: pclass,
                    Name: `Pasajero ${i}`,
                    Sex: sex,
                    Age: age,
                    SibSp: Math.floor(Math.random() * 4),
                    Parch: Math.floor(Math.random() * 4),
                    Ticket: `TKT${i}`,
                    Fare: fare,
                    Cabin: null,
                    Embarked: embarked
                });
            }
        }
        
        // Función para actualizar las estadísticas de los datos
        function updateDataStats() {
            const total = titanicData.length;
            const survived = titanicData.filter(p => p.Survived === 1).length;
            const notSurvived = total - survived;
            const survivalRate = ((survived / total) * 100).toFixed(1);
            
            totalPassengersEl.textContent = total;
            survivedCountEl.textContent = survived;
            notSurvivedCountEl.textContent = notSurvived;
            survivalRateEl.textContent = `${survivalRate}%`;
        }
        
        // Función para entrenar el modelo
        function trainModel() {
            if (titanicData.length === 0) {
                showNotification('Primero cargue los datos', 'error');
                return;
            }
            
            // Limpiar datos (eliminar pasajeros con valores faltantes críticos)
            const cleanData = titanicData.filter(p => 
                p.Sex && p.Pclass && p.Age && p.Fare && p.Embarked
            );
            
            if (cleanData.length < 20) {
                showNotification('No hay suficientes datos completos para entrenar el modelo', 'error');
                return;
            }
            
            // Preparar características y etiquetas
            const features = cleanData.map(passenger => [
                passenger.Pclass,
                passenger.Sex === 'male' ? 0 : 1,
                passenger.Age,
                passenger.Fare,
                passenger.Embarked === 'C' ? 0 : (passenger.Embarked === 'Q' ? 1 : 2)
            ]);
            
            const labels = cleanData.map(passenger => passenger.Survived);
            
            // Implementación simplificada de Naive Bayes
            model = createNaiveBayesModel(features, labels);
            
            // Calcular precisión del modelo
            modelAccuracy = calculateModelAccuracy(model, features, labels);
            
            // Actualizar UI
            accuracyValue.textContent = `${modelAccuracy}%`;
            accuracyFill.style.width = `${modelAccuracy}%`;
            
            // Mostrar mensaje de éxito
            showNotification('Modelo entrenado exitosamente', 'success');
            modelStatus.textContent = `Modelo entrenado con ${cleanData.length} pasajeros. Precisión: ${modelAccuracy}%`;
            
            // Habilitar botones de prueba y predicción
            testModelBtn.disabled = false;
            predictBtn.disabled = false;
        }
        
        // Función para crear un modelo Naive Bayes simplificado
        function createNaiveBayesModel(features, labels) {
            // Separar datos por clase (sobrevivió = 1, no sobrevivió = 0)
            const survivedFeatures = [];
            const notSurvivedFeatures = [];
            
            for (let i = 0; i < labels.length; i++) {
                if (labels[i] === 1) {
                    survivedFeatures.push(features[i]);
                } else {
                    notSurvivedFeatures.push(features[i]);
                }
            }
            
            // Calcular probabilidades a priori
            const total = labels.length;
            const pSurvived = survivedFeatures.length / total;
            const pNotSurvived = notSurvivedFeatures.length / total;
            
            // Calcular medias y desviaciones estándar para cada característica
            const survivedStats = calculateStats(survivedFeatures);
            const notSurvivedStats = calculateStats(notSurvivedFeatures);
            
            return {
                pSurvived,
                pNotSurvived,
                survivedStats,
                notSurvivedStats
            };
        }
        
        // Función para calcular estadísticas (media y desviación estándar)
        function calculateStats(featureArray) {
            const stats = [];
            const numFeatures = featureArray[0].length;
            
            for (let i = 0; i < numFeatures; i++) {
                const values = featureArray.map(row => row[i]);
                const mean = values.reduce((sum, val) => sum + val, 0) / values.length;
                
                const squaredDiffs = values.map(val => Math.pow(val - mean, 2));
                const variance = squaredDiffs.reduce((sum, val) => sum + val, 0) / values.length;
                const stdDev = Math.sqrt(variance);
                
                stats.push({ mean, stdDev: stdDev || 0.1 }); // Evitar división por cero
            }
            
            return stats;
        }
        
        // Función para calcular la precisión del modelo
        function calculateModelAccuracy(model, features, labels) {
            let correct = 0;
            
            for (let i = 0; i < features.length; i++) {
                const prediction = predictWithModel(model, features[i]);
                if (prediction.predictedClass === labels[i]) {
                    correct++;
                }
            }
            
            return ((correct / features.length) * 100).toFixed(1);
        }
        
        // Función para hacer una predicción con el modelo
        function predictWithModel(model, features) {
            // Calcular probabilidad usando distribución normal (Naive Bayes Gaussiano)
            let logPSurvived = Math.log(model.pSurvived);
            let logPNotSurvived = Math.log(model.pNotSurvived);
            
            for (let i = 0; i < features.length; i++) {
                const featureValue = features[i];
                const survivedStat = model.survivedStats[i];
                const notSurvivedStat = model.notSurvivedStats[i];
                
                // Usar distribución normal (Gaussiana)
                const pFeatureGivenSurvived = gaussianPDF(featureValue, survivedStat.mean, survivedStat.stdDev);
                const pFeatureGivenNotSurvived = gaussianPDF(featureValue, notSurvivedStat.mean, notSurvivedStat.stdDev);
                
                // Sumar logaritmos para evitar underflow
                logPSurvived += Math.log(pFeatureGivenSurvived);
                logPNotSurvived += Math.log(pFeatureGivenNotSurvived);
            }
            
            // Convertir de logaritmos a probabilidades
            const pSurvived = Math.exp(logPSurvived);
            const pNotSurvived = Math.exp(logPNotSurvived);
            
            // Normalizar
            const total = pSurvived + pNotSurvived;
            const normalizedPSurvived = pSurvived / total;
            const normalizedPNotSurvived = pNotSurvived / total;
            
            return {
                predictedClass: normalizedPSurvived > normalizedPNotSurvived ? 1 : 0,
                probabilitySurvived: normalizedPSurvived,
                probabilityNotSurvived: normalizedPNotSurvived
            };
        }
        
        // Función de densidad de probabilidad Gaussiana
        function gaussianPDF(x, mean, stdDev) {
            const exponent = -0.5 * Math.pow((x - mean) / stdDev, 2);
            return (1 / (stdDev * Math.sqrt(2 * Math.PI))) * Math.exp(exponent);
        }
        
        // Función para probar el modelo
        function testModel() {
            if (!model) {
                showNotification('Primero entrene el modelo', 'error');
                return;
            }
            
            // Crear datos de prueba aleatorios
            const testFeatures = [];
            const testLabels = [];
            
            for (let i = 0; i < 10; i++) {
                const pclass = Math.floor(Math.random() * 3) + 1;
                const sex = Math.random() > 0.5 ? 0 : 1;
                const age = Math.floor(Math.random() * 70) + 1;
                const fare = pclass === 1 ? Math.random() * 300 + 50 : 
                            pclass === 2 ? Math.random() * 50 + 10 : 
                            Math.random() * 30 + 5;
                const embarked = Math.floor(Math.random() * 3);
                
                testFeatures.push([pclass, sex, age, fare, embarked]);
                
                // Etiqueta real (simulada basada en probabilidades históricas)
                let survivalProbability = 0.5;
                if (sex === 1) survivalProbability += 0.3; // Mujeres tenían mayor probabilidad
                if (pclass === 1) survivalProbability += 0.2; // Primera clase tenía mayor probabilidad
                if (age < 18) survivalProbability += 0.1; // Niños tenían mayor probabilidad
                
                testLabels.push(Math.random() < survivalProbability ? 1 : 0);
            }
            
            // Probar el modelo
            let correct = 0;
            for (let i = 0; i < testFeatures.length; i++) {
                const prediction = predictWithModel(model, testFeatures[i]);
                if (prediction.predictedClass === testLabels[i]) {
                    correct++;
                }
            }
            
            const accuracy = ((correct / testFeatures.length) * 100).toFixed(1);
            showNotification(`Prueba completada: ${correct}/10 correctos (${accuracy}% de precisión)`, 'success');
        }
        
        // Función para hacer una predicción basada en la entrada del usuario
        function makePrediction() {
            if (!model) {
                showNotification('Primero entrene el modelo', 'error');
                return;
            }
            
            // Obtener valores de entrada
            const pclass = parseInt(document.getElementById('pclass').value);
            const sex = document.getElementById('sex').value === 'male' ? 0 : 1;
            const age = parseInt(document.getElementById('age').value) || 30;
            const fare = parseInt(document.getElementById('fare').value) || 30;
            const embarkedValue = document.getElementById('embarked').value;
            const embarked = embarkedValue === 'C' ? 0 : (embarkedValue === 'Q' ? 1 : 2);
            
            // Crear array de características
            const features = [pclass, sex, age, fare, embarked];
            
            // Hacer predicción
            const prediction = predictWithModel(model, features);
            
            // Mostrar resultado
            const survived = prediction.predictedClass === 1;
            const probability = (prediction.probabilitySurvived * 100).toFixed(1);
            
            // Actualizar UI
            predictionResult.className = `prediction-result show ${survived ? 'survived' : 'not-survived'}`;
            
            if (survived) {
                resultIcon.innerHTML = '<i class="fas fa-life-ring"></i>';
                resultText.textContent = '¡SOBREVIVIRÍA!';
                probabilityText.textContent = `Probabilidad: ${probability}%`;
            } else {
                resultIcon.innerHTML = '<i class="fas fa-skull-crossbones"></i>';
                resultText.textContent = 'NO SOBREVIVIRÍA';
                probabilityText.textContent = `Probabilidad de supervivencia: ${probability}%`;
            }
            
            // Agregar explicación
            setTimeout(() => {
                let explanation = '';
                if (sex === 1) {
                    explanation += 'Las mujeres tenían mayor probabilidad de sobrevivir. ';
                }
                if (pclass === 1) {
                    explanation += 'Los pasajeros de primera clase tenían mayor tasa de supervivencia. ';
                }
                if (age < 18) {
                    explanation += 'Los niños tenían prioridad en los botes salvavidas. ';
                }
                
                if (explanation) {
                    probabilityText.innerHTML += `<br><small>${explanation}</small>`;
                }
            }, 500);
        }
        
        // Función para mostrar notificaciones
        function showNotification(message, type) {
            // Crear elemento de notificación
            const notification = document.createElement('div');
            notification.textContent = message;
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 15px 20px;
                border-radius: 5px;
                color: white;
                font-weight: bold;
                z-index: 1000;
                box-shadow: 0 4px 12px rgba(0,0,0,0.15);
                animation: slideIn 0.3s ease;
            `;
            
            if (type === 'success') {
                notification.style.backgroundColor = '#28a745';
            } else if (type === 'error') {
                notification.style.backgroundColor = '#dc3545';
            } else {
                notification.style.backgroundColor = '#17a2b8';
            }
            
            document.body.appendChild(notification);
            
            // Remover después de 3 segundos
            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 300);
            }, 3000);
            
            // Agregar estilos de animación si no existen
            if (!document.querySelector('#notification-styles')) {
                const style = document.createElement('style');
                style.id = 'notification-styles';
                style.textContent = `
                    @keyframes slideIn {
                        from { transform: translateX(100%); opacity: 0; }
                        to { transform: translateX(0); opacity: 1; }
                    }
                    @keyframes slideOut {
                        from { transform: translateX(0); opacity: 1; }
                        to { transform: translateX(100%); opacity: 0; }
                    }
                `;
                document.head.appendChild(style);
            }
        }
        
        // Inicialización de eventos
        document.addEventListener('DOMContentLoaded', function() {
            // Configurar eventos de los botones
            loadDataBtn.addEventListener('click', loadDataset);
            trainModelBtn.addEventListener('click', trainModel);
            testModelBtn.addEventListener('click', testModel);
            predictBtn.addEventListener('click', makePrediction);
            
            // Deshabilitar botones inicialmente
            testModelBtn.disabled = true;
            predictBtn.disabled = true;
            
            // Cargar datos de ejemplo automáticamente
            setTimeout(() => {
                loadDataset();
            }, 500);
        });
    </script>
</body>
</html>
